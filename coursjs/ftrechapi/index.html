<html>
  <head>
    <script>
      async function Login() {
        var tag = await document.createElement("p");
        document.body.appendChild(tag);
        let myHeaders = new Headers();
        let body = {
          username: "peguy",
          password: "peguy",
        };

        myHeaders.append("Content-Type", "application/json");
        const response = await fetch("https://kuz.iotalink.fr/_login/local/", {
          method: "POST",
          headers: myHeaders,
          body: JSON.stringify(body),
        });
        let res = await response.json();
        console.log(res);

        var jwt = await res.result.jwt;
        console.log(jwt);
        localStorage.setItem("jwt", jwt);
        var element = document.getElementById("getid");
        element.removeAttribute("disabled");
      }

      function get(jwt) {
        myHeaders2 = new Headers({
          Authorization: "Bearer " + jwt,
          "Content-Type": "application/json",
        });
        fetch("https://kuz.iotalink.fr/catalogue/produit", {
          headers: myHeaders2,
          method: "GET",
        })
          .then((response) => response.json())
          .then((result) => {
            console.log(result.result.hits[0]);

            for (i = 0; i <= result.result.hits.lenght; i++) {}
          })
          .catch((error) => {
            console.error(error);
          });
      }
    </script>
  </head>

  <body>
    <button onclick="Login()">Login</button>

    <button
      id="getid"
      disabled="disabled"
      onclick="get(localStorage.getItem('jwt'))"
    >
      GetInfo
    </button>
  </body>
</html>
